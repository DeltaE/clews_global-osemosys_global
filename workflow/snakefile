import os

# CONFIGURATION

configfile: 'config/config.yaml'
output_dir = config['outputDir']
scenario = config['scenario']

# HELPER FILES

include: 'rules/preprocess.smk'
include: 'rules/model.smk'
include: 'rules/postprocess.smk'
include: 'rules/file_check.smk'

# HANDLERS 
        
onsuccess:
    print('Workflow finished successfully!')

onerror:
    print('An error occurred, submit issue to '
        'https://github.com/OSeMOSYS/osemosys_global/issues')

# AMBIGUITY FOR FILE CHECK 

ruleorder: 
	PowerPlant > 
	TimeSlice > 
	VariableCosts > 
	DemandProjections > 
	FileCheck

# TARGET RULES

rule all:
    input:
        rules.visualisation.output
        #Path(output_dir, scenario, 'figures/{result_figure}.html')

rule dataFile:
    input:
        rules.preProcess.output
        #Path(output_dir, scenario, '{scenario}.txt')

rule lpFile:
    input: 
        rules.createLP.output
        #Path(output_dir, scenario, '{scenario}.lp')

rule solve:
    input: 
        rules.cbcSolve.output
        #Path(output_dir, scenario, 'figures/{result_figure}.html')

rule makeDag:
    shell:
        'snakemake --dag all | dot -Tpdf > dag.pdf'

# CLEANING RULES

rule cleanAll:
    shell:
        'rm -rf {output_dir}/*'

rule cleanData:
    shell:
        'rm -rf {output_dir}/data/*'

rule cleanFigs:
    shell:
        'rm -rf {output_dir}/figs/*'

rule cleanScenario:
    shell: 
        'rm -r {output_dir}/{scenario}/*'

